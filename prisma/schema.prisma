datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  CUSTOMER
  ADMIN
  SUPERADMIN
}

enum BookingStatus {
  BOOKED
  DITERIMA
  DICUCI
  SIAP_DIAMBIL
  SELESAI
  DIBATALKAN
  EXPIRED
}

enum PaymentStatus {
  UNPAID
  PAID_CASH
}

enum VehicleType {
  MOBIL
  MOTOR
}

enum NotificationType {
  STATUS_UPDATE
  REMINDER
}

model User {
  id       Int    @id @default(autoincrement())
  email    String @unique
  username String @unique
  password String
  name     String
  phone    String @unique
  role     Role   @default(CUSTOMER)

  photoUrl String?

  // Relasi
  location   Location? @relation(fields: [locationId], references: [id])
  locationId Int?

  vehicles      Vehicle[]
  bookings      Booking[]
  notifications Notification[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Vehicle {
  id    Int         @id @default(autoincrement())
  plate String      @unique
  type  VehicleType
  model String?

  // Relasi
  owner   User @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId Int

  // Relasi
  bookings Booking[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Service {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  description String?
  price       Float
  vehicleType VehicleType?

  bookings Booking[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Location {
  id      Int     @id @default(autoincrement())
  name    String
  address String
  phone   String?

  latitude  Float
  longitude Float

  photoUrl String?

  // Relasi
  bookings Booking[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
}

model Booking {
  id Int @id @default(autoincrement())

  bookingNumber String @unique

  queueNumber Int

  bookingDate DateTime
  totalPrice  Float
  status      BookingStatus @default(BOOKED)
  notes       String?

  paymentStatus PaymentStatus @default(UNPAID)

  cancellationReason String?
  cancelledAt        DateTime?

  // Relasi
  user   User @relation(fields: [userId], references: [id])
  userId Int

  vehicle   Vehicle @relation(fields: [vehicleId], references: [id])
  vehicleId Int

  location   Location @relation(fields: [locationId], references: [id])
  locationId Int

  service   Service @relation(fields: [serviceId], references: [id])
  serviceId Int

  statusHistory BookingStatusHistory[]

  notifications Notification[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([locationId])
  @@index([bookingDate])
}

model BookingStatusHistory {
  id     Int           @id @default(autoincrement())
  status BookingStatus // Status yang dicatat (misal: DICUCI, SELESAI)
  notes  String? // Deskripsi opsional, misal: "Kendaraan telah diterima oleh petugas"

  // Relasi: Setiap entri histori dimiliki oleh satu Booking
  booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId Int // Foreign key ke tabel Booking

  // Waktu kapan status ini dicatat
  createdAt DateTime @default(now())
}

model Notification {
  id      Int              @id @default(autoincrement())
  title   String
  message String
  isRead  Boolean          @default(false)
  type    NotificationType

  // Relasi: Setiap notifikasi dimiliki oleh satu User
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int

  // Relasi opsional: Notifikasi bisa terhubung ke satu Booking
  booking   Booking? @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId Int?

  createdAt DateTime @default(now())
}
